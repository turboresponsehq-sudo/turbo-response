{
  "query": "-- Phase 2: RAG System - Vector Database Setup\n\n-- Install pgvector extension (if not already installed)\nCREATE EXTENSION IF NOT EXISTS vector;\n\n-- Create brain_embeddings table for vector storage\nCREATE TABLE IF NOT EXISTS brain_embeddings (\n  id SERIAL PRIMARY KEY,\n  \n  -- Link to source document\n  document_id INTEGER NOT NULL REFERENCES brain_documents(id) ON DELETE CASCADE,\n  \n  -- Chunk information\n  chunk_index INTEGER NOT NULL, -- Position in document (0, 1, 2, ...)\n  chunk_text TEXT NOT NULL, -- The actual text chunk\n  chunk_tokens INTEGER, -- Token count for cost tracking\n  \n  -- Vector embedding (1536 dimensions for text-embedding-3-small)\n  embedding vector(1536) NOT NULL,\n  \n  -- Metadata for search and filtering\n  document_title TEXT,\n  document_domain VARCHAR(100),\n  document_category VARCHAR(100),\n  document_tags TEXT[],\n  \n  -- Timestamps\n  created_at TIMESTAMP DEFAULT NOW(),\n  \n  -- Composite unique constraint\n  UNIQUE(document_id, chunk_index)\n);\n\n-- Create indexes for fast vector similarity search\nCREATE INDEX IF NOT EXISTS idx_embeddings_vector ON brain_embeddings USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);\nCREATE INDEX IF NOT EXISTS idx_embeddings_document ON brain_embeddings(document_id);\nCREATE INDEX IF NOT EXISTS idx_embeddings_domain ON brain_embeddings(document_domain);\nCREATE INDEX IF NOT EXISTS idx_embeddings_category ON brain_embeddings(document_category);\nCREATE INDEX IF NOT EXISTS idx_embeddings_tags ON brain_embeddings USING GIN(document_tags);\n\n-- Add comments for documentation\nCOMMENT ON TABLE brain_embeddings IS 'Vector embeddings for semantic search in Brain Upload System';\nCOMMENT ON COLUMN brain_embeddings.embedding IS 'OpenAI text-embedding-3-small vector (1536 dimensions)';\nCOMMENT ON COLUMN brain_embeddings.chunk_index IS 'Sequential position of chunk in source document';\nCOMMENT ON INDEX idx_embeddings_vector IS 'IVFFlat index for fast cosine similarity search';",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 7DorTNURquHZQZu.root --database WQoqrgvAJmZqDJX9hYJoWw --execute -- Phase 2: RAG System - Vector Database Setup\n\n-- Install pgvector extension (if not already installed)\nCREATE EXTENSION IF NOT EXISTS vector;\n\n-- Create brain_embeddings table for vector storage\nCREATE TABLE IF NOT EXISTS brain_embeddings (\n  id SERIAL PRIMARY KEY,\n  \n  -- Link to source document\n  document_id INTEGER NOT NULL REFERENCES brain_documents(id) ON DELETE CASCADE,\n  \n  -- Chunk information\n  chunk_index INTEGER NOT NULL, -- Position in document (0, 1, 2, ...)\n  chunk_text TEXT NOT NULL, -- The actual text chunk\n  chunk_tokens INTEGER, -- Token count for cost tracking\n  \n  -- Vector embedding (1536 dimensions for text-embedding-3-small)\n  embedding vector(1536) NOT NULL,\n  \n  -- Metadata for search and filtering\n  document_title TEXT,\n  document_domain VARCHAR(100),\n  document_category VARCHAR(100),\n  document_tags TEXT[],\n  \n  -- Timestamps\n  created_at TIMESTAMP DEFAULT NOW(),\n  \n  -- Composite unique constraint\n  UNIQUE(document_id, chunk_index)\n);\n\n-- Create indexes for fast vector similarity search\nCREATE INDEX IF NOT EXISTS idx_embeddings_vector ON brain_embeddings USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);\nCREATE INDEX IF NOT EXISTS idx_embeddings_document ON brain_embeddings(document_id);\nCREATE INDEX IF NOT EXISTS idx_embeddings_domain ON brain_embeddings(document_domain);\nCREATE INDEX IF NOT EXISTS idx_embeddings_category ON brain_embeddings(document_category);\nCREATE INDEX IF NOT EXISTS idx_embeddings_tags ON brain_embeddings USING GIN(document_tags);\n\n-- Add comments for documentation\nCOMMENT ON TABLE brain_embeddings IS 'Vector embeddings for semantic search in Brain Upload System';\nCOMMENT ON COLUMN brain_embeddings.embedding IS 'OpenAI text-embedding-3-small vector (1536 dimensions)';\nCOMMENT ON COLUMN brain_embeddings.chunk_index IS 'Sequential position of chunk in source document';\nCOMMENT ON INDEX idx_embeddings_vector IS 'IVFFlat index for fast cosine similarity search';",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 4: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 16 near \"EXTENSION IF NOT EXISTS vector\""
  ]
}